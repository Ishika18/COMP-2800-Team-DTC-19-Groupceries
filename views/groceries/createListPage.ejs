<!-- SS - create new grocery item page. -->
<%- include('../partials/appNavbar.ejs'); -%>
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
<link rel="stylesheet" type="text/css" href=/css/styleCreateListPage.css>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.js"></script>


<div class="container" style="margin-top: 20px">
    <div class="row">
    <div class="col-lg-3">
    <h3>Shopping Lists</h3><hr>
       <div id="myLists">
           <button id="myLists" class="btn collapsible">My Lists</button>
           <ul id="lists" class="collapse">
                <p>My List</p>
                <p>List 2</p>
                <p>List 3</p>
           </ul>
        </div>
        <div id="friendLists">
            <button id="friendLists" class="btn collapsible">Friends' Lists</button>
            <div class="collapse">
            <ul id="shagun" class="collapsible">Shagun's Lists</ul>
                <p class="collapse">List 1</p>
            <ul id="ronald" class="collapsible">Ronald's Lists</ul>
                <p class="collapse">List 1</p>
            <ul id="eric" class="collapsible">Eric's Lists</ul>
                <p class="collapse">List 1</p>
           </ul>
            </div>
        </div>
    </div>
    <div class="col-lg-6">
                  
        <div id="listArea">
            <div id="buttons">
                <h2 id="listTitle">My List</h2>
                <button id="newItem" type="button">New Item</button>
            </div>
            <div id="groceryList">
            </div>
    </div>
    </div>
    <div class="col-lg-3" id="listActions">
        <h3>List Actions</h3><hr><br>
        <ul>
            <label for="readyToggle">Mark as Ready For Purchase</label>
            <input id="readyToggle" type="checkbox" data-role="flipswitch" name="flip-checkbox-2" id="flip-checkbox-2" data-on-text="Ready" data-off-text="Not Ready" data-wrapper-class="custom-size-flipswitch"><br>
            <label for="readyToggle">Shopping Mode</label>
            <input type="checkbox" data-role="flipswitch" name="flip-checkbox-4" id="flip-checkbox-4" checked=""><br>
            <label for="merge">Merge List</label>
        </ul>
    </div>
</div>
</div>



<script>
    function newItemField() {
    let item = document.createElement("div")
    item.className = "listItems"
    let list = document.getElementById("groceryList")
    list.appendChild(item)
    var fields = ["Name", "Quantity", "Units", "Notes(Optional)"]
    var i

    for(i=0; i <fields.length; i++) {
        input = document.createElement("input")
        input.setAttribute("type", "text")
        input.id = fields[i]
        input.classList = "textInput"
        label = document.createElement("label")
        label.innerHTML = fields[i]
        item.appendChild(label)
        item.appendChild(input)
    }
        addButton = document.createElement("button")
        addButton.innerHTML = "Add"
        addButton.id = "addButton"
        item.appendChild(addButton)
        addButton.onclick = addItemDetails(item)
    }

document.getElementById("newItem").onclick = newItemField

    function addItemDetails(item) {
        return function() {
            add = document.getElementById("addButton")
            editButton = document.createElement("button")
            editButton.id = "editButton"
            editButton.onclick = edit(item)
            editButton.innerHTML = "Edit"
            item.replaceChild(editButton, add)
            var fields = item.getElementsByClassName("textInput")
            var fieldsCopy = []
            for (field in fields) {
                fieldsCopy[field] = fields[field] //create shallow copy to prevent errors related to list length
            }
            var i

            for (i=0; i< fieldsCopy.length; i++) {
                input = fieldsCopy[i]
                input.className = "disabledInput"
                input.disabled = true;
        }
    }
}

    function edit(item) {
        return function() {
            editButton = document.getElementById("editButton")
            save = document.createElement("button")
            save.innerHTML = "Save Changes"
            save.id = "saveButton"
            save.onclick = saveChanges(item)
            item.replaceChild(save, editButton)
            var fields = item.getElementsByClassName("disabledInput")
            var fieldsCopy = []
            for (field in fields) {
                fieldsCopy[field] = fields[field] //create shallow copy to prevent errors related to list length
            }
            var i

            for (i=0; i< fieldsCopy.length; i++) {
                input = fieldsCopy[i]
                input.className = "textInput"
                input.disabled = false;
        }
    }
}
    function saveChanges(item) {
            return function() {
                let saveButton = document.getElementById("saveButton")
                let editButton = document.createElement("button")
                editButton.id = "editButton"
                editButton.innerHTML = "Edit"
                editButton.onclick = edit(item)
                item.replaceChild(editButton, saveButton)
                var fields = item.getElementsByClassName("textInput")
                var fieldsCopy = []
                for (field in fields) {
                    fieldsCopy[field] = fields[field] //create shallow copy to prevent errors related to list length
                }
                var i

                for (i=0; i< fieldsCopy.length; i++) {
                    input = fieldsCopy[i]
                    input.className = "disabledInput"
                    input.disabled = true;
            }
        }
    }     

    function collapse() {
        var coll = document.getElementsByClassName("collapsible");
        var i;

        for (i = 0; i < coll.length; i++) {
            coll[i].onclick = function() {
                this.classList.toggle("active");
                var content = this.nextElementSibling;
                if (content.style.display === "block") {
                    content.style.display = "none";
                } else {
                    content.style.display = "block";
                }
            };
        }
    }


    collapse()

      
</script>

<script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-storage.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-auth.js"></script>
<script src="/js/firebaseInit.js"></script>
<!-- the sidebar is to be included as well. -->